## BitCoin

比特币钱包有 N 个公钥（公钥对应收款地址，公钥里有特殊字符，所以实际地址是公钥转换了一下得来的），每个地址都有自己的私钥，wallet.dat 是私钥的集合

每次接收转账比特币钱包都会生成新的地址和私钥，达到隐藏自己资产的目的

wallet.dat 会自动帮我们维护地址和私钥对儿，所以给别人转账不需要手动自己选择一个地址作为转出方

## 比特币转账

比特币没有总账户的概念，每个人的可用资金是所有其他人给你转账的记录的总合

其他人给你的转账对你来说叫做输入，对其他人来说叫做输出

其他人给你转账时会使用你的公钥锁定这个输出，所以对你来说你就拥有了对这个输出的使用权

所以比特币中有个概念 UTXO (unspent transaction output) 代表了未使用的输出，如果这些输出都是给你的，那么这些输出的数值加起来就是你的总资金

在比特币转账时需要从你拥有的这些个 utxo 中挑选一个金额比较合适的进行转账，剩余的部分还需要转给你，当作你的一个新的 utxo 。比如你要转给 Tom 0.8btc ，你使用一个 1btc 的地址进行转账，你除了需要给 Tom 转 0.8 个外，还需要给自己账户再转 0.2 个，这个 0.2 的输出会成为你新的输入供下次使用，如果没有这一步，相当于你的钱就没了

#### 挖矿过程

挖矿其实就是找满足条件（ sha256 结果比系统设定的难度值小）的随机值的过程

![](./wk.jpg)

## 以太坊基础

#### Provider

当我们想要与区块链上的数据和代码进行交互时，我们只需要找其中一个节点进行交互，因为任何节点都可以广播将要在 EVM 上执行的事务的请求

与区块链交互时连接的节点（无论是自己部署的还是使用来自第三方服务的现有节点）通常被称为 "Provider" ，比如小狐狸钱包就是一个 provider

自己存储以太坊区块信息可以使自己成为一个 provider ，但存储完整的以太坊区块链成本很高，所以一般选择第三方节点服务（ provider ）

#### 以太坊账户类型

###### 外部账户

普通账户，所有以太坊的交易都由外部账户发起，它没有关联代码。使用用户私钥进行控制

###### 合约账户

内部账户，有关联代码

###### 交易和消息

交易是外部账户发起的，会打包区块上链；消息是合约之间进行的调用

#### 公钥与私钥

私钥经过某种计算可以推导出公钥，但是公钥没办法推导出私钥

#### 公钥加密场景

<img src="./gongyao.png" style="zoom:150%;" />

公钥加密用于给特定人发消息，用接收方的公钥将信息加密，只有接收方有自己的私钥，可以解密消息，其他人无法解密消息

#### 私钥签名场景

<img src="./siyao.png" style="zoom:150%;" />

私钥签名用于证明消息是自己发的，用自己的私钥将信息加密，所有人都可以用我的公钥将信息解密

#### 实际签名过程

![](./qianming2.png)

###### 发送文件场景

1. A 用户根据文件数据算出一个 hash ，并将算出的 hash 用自己的 `私钥` 加密得到签名 sign
2. A 将源文件和签名 sign 一块发给对方 B
3. B 得到一个签名 sign 和一个源文件
4. B 把得到的 sign 用发 A 的公钥解密得到一个 hash2 值
5. B 把源文件算出 hash3
6. 如果 hash2 === hash3 那么文件是 A 发送的（因为用 A 的公钥可以解密出哈希），且没有被篡改

###### 区块链转账场景

1. 付款方用自己的私钥对交易数据（包含了付款地址、收款地址、金额等信息）算出的 hash 值进行加密，得到签名数据

2. 广播自己的交易给矿工

   类似于：我支付了 10 eth 到 0x12345678 地址，签名信息是 abcdefg...，大家来验证一下把

   广播的时候把自己产生 `交易数据` 和 `签名数据` 要一并广播出去给矿工

3. 验证

   矿工得到 交易数据 和 签名数据

   矿工用付款人的公钥（公钥从哪里来还没搞清）可以对签名数据进行解密，得到一个 hash1

   矿工对交易数据进行计算得到一个 hash2 值，如果 hash1 === hash2 那么交易合法


## bitcoin 公钥转换成收钱地址过程

![](./gongyao_dizhi.png)

version 部分是为了区分不同的网络，如测试网 和 正式网

> 以太坊地址生成和比特币不同，以太坊地址是十六进制数字，是从公钥 Keccak-256 哈希的最后 20 个字节派生的标识符

## 区块

区块本身只会存储前一个区块的 hash ，本区快的 hash 不会存储

节点在接收到区块后会在本地自己计算区块的 hash 。这样做是为了方便索引区块便于查找，避免查找某个区块时遍历操作



## 跨链桥

存在两种跨链桥：任意消息跨链桥（Arbitrary Message Briage，AMB）和资产跨链桥。其中，资产跨链桥又分为封装代币桥（Wrap 桥）和流动性兑换桥（Swap 桥）。本报告重点阐述资产跨链桥



