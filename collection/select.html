<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Select</title>
    
<style>
.yselect {
    position: relative;
    display: inline-block;
    background-color: #fff;
    height: 30px;
    line-height: 30px;
    padding: 0 12px;
    font-size: 14px;
    color: rgba(0, 0, 0, .6);
    border: 1px solid #d9d9d9;
    border-radius: 4px;
    transition: border-color .5s;
}
.yselect:after {
    content: '▼';
    position: absolute;
    top: 0;
    right: 6px;
}
.yselect:focus,
.yselect:hover {
    border-color: #49a9ee
}
.yselect-list {
    position: absolute;
    z-index: 600;
    left: 0;
    top: 31px;
    width: 100%;
    max-height: 300px;
    padding: 10px 0;
    background-color: #fff;
    overflow-y: auto;
    box-shadow: 0 4px 6px 0 rgba(0, 0, 0, .2);
    display: none;
}
.yselect-list span {
    display: block;
    height: 32px;
    line-height: 32px;
    padding: 0 6px;
}
.yselect-list span:hover {
    background-color: #eee;
    cursor: pointer;
}
</style>
</head>
<body>
    
    <div id="demo" data-value="9" style="width: 120px">
        <div class="yselect-list">
            <span data-role="item" data-value="1">选项1</span>
            <span data-role="item" data-value="2">选项2</span>
            <span data-role="item" data-value="3">选项3</span>
            <span data-role="item" data-value="4">选项4</span>
            <span data-role="item" data-value="5">选项5</span>
            <span data-role="item" data-value="6">选项6</span>
            <span data-role="item" data-value="7">选项7</span>
            <span data-role="item" data-value="8">选项8</span>
            <span data-role="item" data-value="9">选项9</span>
            <span data-role="item" data-value="0">选项0</span>
        </div>
    </div>
    
    <br/><br/><br/>
    
    <div id="demo2" data-value="0" style="width: 80px"></div>

<script>
function YSelect() {
    this.doc = document;
    this.wrapper = null;
    this.tipWrapper = null;
    this.listWrapper = null;
    this.value = '';
    this.onchange = null;
}
YSelect.prototype = {
    constructor: YSelect,
    E: {
        addHandler: function(ele, type, func) {
            if(ele.addEventListener) {
                ele.addEventListener(type, func, false);
                
            } else if(ele.attachEvent) {
                ele.attachEvent('on' + type, func);
                
            } else {
                ele['on' + type] = func;
            }
        },
        removeHandler: function(ele, type, func) {
            if(ele.removeEventListener) {
                ele.removeEventListener(type, func, false);
                
            } else if(ele.detachEvent) {
                ele.detachEvent('on' + type, func);
                
            } else {
                ele['on' + type] = null;
            }
        }
    },
    closeList: function() {
        this.listWrapper.style.display = 'none';
    },
    eventHandler: function(e) {
        e.stopPropagation && e.stopPropagation();
        e.cancelBubble = true;
        
        var target = e.target || e.srcElement;
        
        if('block' !== this.listWrapper.style.display) {
            this.listWrapper.style.display = 'block';
            
        } else {
            this.listWrapper.style.display = 'none';
        }
        
        if('item' === target.getAttribute('data-role')) {
            this.value = target.getAttribute('data-value');
            this.tipWrapper.innerHTML = target.innerHTML;
            
            null !== this.onchange && this.onchange(this.value);
        }
    },
    initStructure: function(items) {
        this.wrapper.className = 'yselect';
        
        this.tipWrapper = this.doc.createElement('span');
        this.tipWrapper.className = 'yselect-value';
        
        if(undefined !== items) {
            var ret = '';
            for(var i=0,len=items.length; i<len; i++) {
                ret += '<span data-role="item" data-value="'+ items[i].value +'">'+ items[i].text +'</span>'
            }
            
            this.listWrapper = this.doc.createElement('div');
            this.listWrapper.className = 'yselect-list';
            this.listWrapper.innerHTML = ret;
            
            this.tipWrapper.innerHTML = items[0].text;
                        
        } else {
            this.listWrapper = this.wrapper.querySelector('.yselect-list');
            var first = this.listWrapper.querySelector('[data-role="item"]');
            
            this.tipWrapper.innerHTML = first.innerHTML;
        }
        
        this.wrapper.appendChild(this.tipWrapper);
        this.wrapper.appendChild(this.listWrapper);
        
        // 默认值
        var value = null;
        var list = null;
        if(null !== (value = this.wrapper.getAttribute('data-value'))) {
            this.value = value;
            
            list = this.listWrapper.querySelectorAll('[data-role="item"]');
            for(var i=0,len=list.length; i<len; i++) {
                if(value === list[i].getAttribute('data-value')) {
                    // 显示选定项
                    this.tipWrapper.innerHTML = list[i].innerHTML;
                    
                    break;
                }
            }
        }
    },
    getValue: function() {
        return this.value;
    },
    /**
     * 渲染
     *
     * @param {String} id
     * @param {Array} items
     * [ {text: '选项', value: 1} ]
     */
    render: function(id, items) {
        var self = this;
        var select = this.wrapper = this.doc.getElementById(id);
        
        this.initStructure(items);
        
        select.onclick = function(e) {
            self.eventHandler(e);
        };
        select = null;
        
        this.E.addHandler(this.doc, 'click', function(e){
            self.closeList();
        });
        
        return this;
    }
};

var demo = new YSelect().render('demo');
demo.onchange = function(v) {
    console.log(v)
};
var demo2 = new YSelect().render('demo2', [{text: '男', value: 1}, {text: '女', value: 0}])
demo2.onchange = function(v) {
    console.log(v)
};
</script>
</body>
</html>
